# Expert-Issues Summary (Excluding Router) — RFC 9810 §7 (CMP version negotiation)

RFC: 9810  
Section: 7 (pvno negotiation, unsupportedVersion handling, legacy cmp1999 interop)

This summarizes **all potential bugs raised by the experts** (not the router), deduplicated.

---

## 1) Retry semantics after `unsupportedVersion` are underspecified: does the retry reuse the same `transactionID`, and does the error terminate the transaction?

**Concise explanation:**  
§7 says that if the client receives `ErrorMsgContent` with `failInfo.unsupportedVersion` and a version it supports, it **MAY retry** the request with that version. But the spec doesn’t say whether that retry is:
- a *new transaction* (new `transactionID`), or
- a continuation of the same transaction (reuse the prior `transactionID`).

This matters because `transactionID` semantics elsewhere are strict (e.g., `transactionIdInUse` for “first message” collisions).

**Justification:** ✅ Plausible underspecification with interoperability risk  
Different client/server implementations can reasonably diverge:
- some will reuse the same `transactionID` when “retrying,”
- others will treat the error as terminating the transaction and require a fresh `transactionID`,
- servers may consider the old `transactionID` still “in use,” yielding `transactionIdInUse` on the retry.

This can create hard-to-debug failures specifically around version negotiation, and may also interact with contexts where `transactionID` is used as KDF context (e.g., KEM-related constructions).

**Experts mentioning this issue:**  
- Temporal

**Fix direction:**  
Explicitly state whether `unsupportedVersion` ends the transaction and whether the retry MUST use a new `transactionID` (or MUST reuse the existing one), and align that with `transactionIdInUse` behavior.

---

## 2) When downgrading pvno, the spec doesn’t explicitly say the retried message MUST be compatible with the downgraded version

**Concise explanation:**  
§7 allows retrying at a lower version, but it doesn’t explicitly instruct clients to remove/avoid **cmp2021-only** syntax when retrying with `cmp2000` (even though other sections tie features like EnvelopedData, `hashAlg` in `CertStatus`, `POPOPrivKey.agreeMAC`, and `ckuann` with `RootCaKeyUpdateContent` to pvno=cmp2021).

**Justification:** ✅ Practical underspecification / foot-gun  
A naive implementation could “retry” by only changing `pvno`, but keep cmp2021-only structures, causing repeated failure or misparsing. The requirement is *implied* by other MUSTs, but not stated in the retry rule itself.

**Experts mentioning this issue:**  
- Temporal

**Fix direction:**  
Add an explicit sentence near the retry rule: any retry at a lower version MUST also adapt message contents to be valid for that version (omit higher-version-only constructs).

---

## Non-issues (per experts)
- **Deontic**: no deontic inconsistency found; the SHOULD/ MUST layering around cmp2021 selection is coherent.
- **CrossRFC**: no cross-RFC mismatches found in §7.
- **Boundary**: no boundary-case specification bug found (though note: Temporal expert still flags process-level ambiguities).

---
